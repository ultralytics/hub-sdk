# Ultralytics HUB-SDK ðŸš€, AGPL-3.0 license
# HUB-SDK Continuous Integration (CI) GitHub Actions tests

name: HUB-SDK CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  schedule:
    - cron: "0 0 * * *" # runs at 00:00 UTC every day
  workflow_dispatch:

env:
  FIREBASE_CRED: ${{ secrets.FIREBASE_CRED }}
  ULTRALYTICS_HUB_API: ${{ vars.ULTRALYTICS_HUB_API }}
  ULTRALYTICS_HUB_WEB: ${{ vars.ULTRALYTICS_HUB_WEB }}
  BUCKET_NAME: ${{ vars.BUCKET_NAME }}

jobs:
  Docs:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"
          cache: "pip" # caching pip dependencies

      - name: Install Dependencies
        run: |
          pip install -e ".[dev]"
        shell: bash

      - name: Build Docs and Check for Warnings
        run: |
          mkdocs build --strict
        shell: bash

  Tests:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Install dependencies
        run: |
          cd tests
          pip install -r requirements.txt
      - name: Download Test Data
        run: |
          cd tests
          python utils/test_data.py download
      - name: Run pytest
        run: python -m pytest -v -m "smoke" tests
